#从索引谈起
>2014/11/4

理解索引很简单，其实就是查字典的过程，一本字典从头翻到尾，这是顺序扫描。如果先在目录中查找则可以快很多。一般汉语字典，也提供了几种索引方法，比如按首字母，按笔画等。其实数据库大致也是这样做的。

而常用的索引是B树，简单的理解就是建立一颗查找树，相比简单的二叉树查找，B树将一个范围range作为一个节点，这样树的层次会降低。


#什么时候适合索引
索引的好处是可以快速定位目标（哈希则是直接定位目标）。在关系型数据库中索引是针对列的，可以是一列，也可以是多列，pgsql还可以针对函数的索引。
1. 需要索引的列应该是查询时需要的过滤条件，不然就没必要索引。
2. 修改数据需要维护索引，维护索引会占用计算存储资源，所以索引不是越多越好
3. 索引对不等于，不存在于等操作是无效的
4. 枚举类型（或者是值范围很少，例如只有两个值，男女）应该不需要索引，因为索引不会使查的更快
5. like查询是索引基本无效的（‘abc%’除外）

总而言之，索引可以提高查询效率，但是不是随意索引就行的。

#关系
关系型数据库，之所以叫关系，就是因为需要多表查询。一本字典就不是一个关系数据库，只能是个文档集合。数据库查询性能下降很大，就是因为很多计算工作都被数据库承担了，而不合理的索引会加大难度。所以越来越多的系统开始抛弃关系数据库，而采用简单的文档存储，保持系统简单，那么维护这些文档间的关系就需要用代码来维护了。为什么？因为目前的瓶颈在于硬盘存储的速度太慢。复杂的联表查询，根本不能适应大规模的数据更新和查询。所以键值存储才会在高度实时的系统中大放光彩，例如推特，索引是哈希的，存储是内存级的。关系简单了，自然查询和更新就快了。

#系统优化原则
1. 减少等待时间，特别是IO的等待，阻塞式操作是限制系统并发的主要因素。所以tornado出来了，他的主要工作是socket是非阻塞的，可接受大量的并发，但是除了http的阻塞，其实还有很多地方阻塞，比如数据库操作，比如复杂计算操作，如果这些地方的等待不解决，系统的并发还是会被限制住。
2. 减少重复计算时间，最常见的方案就是空间换时间，也就是缓存，缓存就是保存计算结果，下次来了用老结果返回就好，大部分系统功能是可以使用缓存的。缓存可以对页面，对计算结果，对查询结果等等进行。
3. 减少计算时间，很常见的就是用c代码来提速，pypy可以提速，这些是底层的优化。但真正要做的是设计的优化，减少不必要的计算，及时终止运算，将部分运算放到客户端去进行。




